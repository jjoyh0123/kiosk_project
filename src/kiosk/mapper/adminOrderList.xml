<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="adminOrderList">

	<!-- 주문내역 불러오기 -->
	<select id="orderList" resultType="kiosk.adminVO.OrderVO">
		SELECT o.orderNumber,
		GROUP_CONCAT(DISTINCT CONCAT(p.productName, ' ', o.orderCount , '개') ORDER BY o.productIdx
		SEPARATOR ', ') AS products,
		SUM(o.orderCouponApplyPrice) AS totalOrderPrice,
		MAX(c.couponName) AS appliedCoupon,
		MIN(o.orderDate) AS orderDate,
		MIN(o.orderStatus) AS orderStatus
		FROM `order` o
		LEFT JOIN product p ON o.productIdx = p.productIdx
		LEFT JOIN coupon c ON o.couponIdx = c.couponIdx
		WHERE orderDate = CURDATE()
		GROUP BY o.orderNumber
		ORDER BY orderStatus ASC, orderDate DESC
	</select>

	<update id="updateOrderStatus" parameterType="kiosk.adminVO.OrderVO">
		UPDATE `order`
		SET
		orderStatus = #{orderStatus}
		WHERE orderNumber = #{orderNumber}
	</update>

</mapper>